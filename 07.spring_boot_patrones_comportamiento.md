# Patrones de comportamiento aplicados en Spring Boot

---

# Strategy

## üéØ Ejemplo 01: Estrategias de pago

En este ejemplo, estamos construyendo un sistema flexible para manejar diferentes m√©todos de pago, utilizando el
`patr√≥n Strategy`. Para ello, definimos una `interfaz com√∫n` para las solicitudes de pago y varios record que
representan las distintas formas de pago. Aqu√≠ analizamos las decisiones clave:

### ‚úÖ Uso de record en lugar de clases tradicionales

Se opt√≥ por utilizar record para definir los objetos de solicitud de pago (`DTOs`). Los record son una caracter√≠stica
introducida en Java 14 (estable en Java 16) que permite crear clases inmutables y concisas, ideales para transportar
datos sin necesidad de escribir constructores, getters o m√©todos como `toString()`, `equals()` o `hashCode()`
manualmente.

Cada forma de pago cuenta con su propio record, el cual encapsula los datos espec√≠ficos que requiere ese m√©todo. Por
ejemplo:

- `PayPalPaymentRequest` incluye email y contrase√±a.
- `BankTransferPaymentRequest` contiene datos bancarios como el titular, nombre del banco y el n√∫mero de cuenta.
- `CreditCardPaymentRequest` define los datos de la tarjeta de cr√©dito como n√∫mero, vencimiento y c√≥digo de seguridad
  (CVV).

````java
public record PayPalPaymentRequest(String orderId,
                                   double amount,
                                   String currency,
                                   String paypalEmail,
                                   String password) implements PaymentRequest {
}
````

````java
public record BankTransferPaymentRequest(String orderId,
                                         double amount,
                                         String currency,
                                         String accountHolder,
                                         String bankName,
                                         String accountNumber) implements PaymentRequest {
}
````

````java
public record CreditCardPaymentRequest(String orderId,
                                       double amount,
                                       String currency,
                                       String cardNumber,
                                       String expiryDate,
                                       String cvv) implements PaymentRequest {

}
````

### üí° Por qu√© se usa una interfaz (PaymentRequest) en lugar de una clase abstracta

Una `limitaci√≥n importante de los record` en Java es que `no pueden extender clases (ni abstractas ni concretas)`.
Todos los record extienden impl√≠citamente `java.lang.Record` como superclase final. Por ello:

> No es posible crear una jerarqu√≠a como `abstract class PaymentRequest { ... }` y que los record la extiendan.

La soluci√≥n correcta en este caso es definir una `interfaz`, como `PaymentRequest`, que los record s√≠ pueden
implementar. Esto permite que todas las solicitudes de pago compartan una estructura com√∫n (como `orderId`, `amount` y
`currency`), y puedan ser tratadas de forma polim√≥rfica. Por ejemplo:

````java
void processPayment(PaymentRequest request);
````

Esto facilita la implementaci√≥n del `patr√≥n Strategy` m√°s adelante, ya que cada estrategia puede operar sobre su tipo
espec√≠fico, pero tambi√©n podemos validar o enrutar por la interfaz base.

### üì¶ Detalle de la interfaz PaymentRequest

Esta interfaz define tres m√©todos comunes a todas las solicitudes de pago:

````java
public interface PaymentRequest {
    String orderId();

    double amount();

    String currency();
}
````

Al ser implementada por cada record, garantiza que todas las solicitudes posean esos campos fundamentales.

### üì§ PaymentResponse

Finalmente, tambi√©n definimos un record llamado `PaymentResponse`, que encapsula la respuesta com√∫n que devuelve
cualquier estrategia de pago:

- `success`: indica si el pago fue exitoso.
- `transactionId`: un identificador √∫nico de la transacci√≥n.
- `message`: mensaje opcional para retroalimentaci√≥n.

Este DTO tambi√©n sigue el mismo enfoque inmutable, claro y orientado a datos.

````java
public record PaymentResponse(boolean success,
                              String transactionId,
                              String message) {
}
````
